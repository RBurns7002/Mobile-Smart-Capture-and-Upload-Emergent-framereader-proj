<TaskerData sr="" dession="com.joaomgcd.tasker" sv="4">
  <Profile sr="prof1" ve="2">
    <cname>FrameReader Auto Capture</cname>
    <id>1</id>
    <mid0>2</mid0>
  </Profile>
  
  <Task sr="task2">
    <cname>FrameReader Capture</cname>
    <id>2</id>
    
    <!-- Variable Setup -->
    <Action sr="act0" ve="7">
      <code>547</code>
      <Str sr="arg0" ve="3">session_code</Str>
      <Str sr="arg1" ve="3">%SESSION_CODE</Str>
      <Int sr="arg2" val="0"/>
    </Action>
    
    <Action sr="act1" ve="7">
      <code>547</code>
      <Str sr="arg0" ve="3">api_url</Str>
      <Str sr="arg1" ve="3">https://framereader.preview.emergentagent.com/api</Str>
      <Int sr="arg2" val="0"/>
    </Action>
    
    <Action sr="act2" ve="7">
      <code>547</code>
      <Str sr="arg0" ve="3">scroll_px</Str>
      <Str sr="arg1" ve="3">800</Str>
      <Int sr="arg2" val="0"/>
    </Action>
    
    <Action sr="act3" ve="7">
      <code>547</code>
      <Str sr="arg0" ve="3">interval_ms</Str>
      <Str sr="arg1" ve="3">1500</Str>
      <Int sr="arg2" val="0"/>
    </Action>
    
    <Action sr="act4" ve="7">
      <code>547</code>
      <Str sr="arg0" ve="3">total_captures</Str>
      <Str sr="arg1" ve="3">10</Str>
      <Int sr="arg2" val="0"/>
    </Action>
    
    <!-- Connect to session -->
    <Action sr="act5" ve="7">
      <code>339</code>
      <Str sr="arg0" ve="3">POST</Str>
      <Str sr="arg1" ve="3">%api_url/mobile/connect/%session_code</Str>
      <Str sr="arg2" ve="3">{"userAgent":"Tasker-Android","screenWidth":%DISPLAY_WIDTH,"screenHeight":%DISPLAY_HEIGHT}</Str>
      <Str sr="arg3" ve="3">application/json</Str>
      <Int sr="arg4" val="30"/>
      <Int sr="arg5" val="1"/>
    </Action>
    
    <!-- Flash notification -->
    <Action sr="act6" ve="7">
      <code>548</code>
      <Str sr="arg0" ve="3">FrameReader: Starting capture in 3 seconds...</Str>
      <Int sr="arg1" val="1"/>
    </Action>
    
    <!-- Wait 3 seconds -->
    <Action sr="act7" ve="7">
      <code>30</code>
      <Int sr="arg0" val="3"/>
      <Int sr="arg1" val="0"/>
    </Action>
    
    <!-- Capture Loop -->
    <Action sr="act8" ve="7">
      <code>39</code>
      <Str sr="arg0" ve="3">capture_count</Str>
      <Str sr="arg1" ve="3">1</Str>
      <Str sr="arg2" ve="3">%total_captures</Str>
      <Str sr="arg3" ve="3">1</Str>
      
      <!-- Take Screenshot -->
      <Action sr="act9" ve="7">
        <code>808</code>
        <Str sr="arg0" ve="3">/sdcard/DCIM/framereader/frame_%capture_count.png</Str>
        <Int sr="arg1" val="0"/>
      </Action>
      
      <!-- Wait for screenshot to save -->
      <Action sr="act10" ve="7">
        <code>30</code>
        <Int sr="arg0" val="0"/>
        <Int sr="arg1" val="500"/>
      </Action>
      
      <!-- Read file as Base64 -->
      <Action sr="act11" ve="7">
        <code>417</code>
        <Str sr="arg0" ve="3">/sdcard/DCIM/framereader/frame_%capture_count.png</Str>
        <Str sr="arg1" ve="3">image_base64</Str>
        <Int sr="arg2" val="1"/>
      </Action>
      
      <!-- Upload frame -->
      <Action sr="act12" ve="7">
        <code>339</code>
        <Str sr="arg0" ve="3">POST</Str>
        <Str sr="arg1" ve="3">%api_url/mobile/upload-batch/%session_code</Str>
        <Str sr="arg2" ve="3">[{"frame_index":%capture_count,"scroll_position":%capture_count*%scroll_px,"image_base64":"%image_base64"}]</Str>
        <Str sr="arg3" ve="3">application/json</Str>
        <Int sr="arg4" val="60"/>
        <Int sr="arg5" val="1"/>
      </Action>
      
      <!-- Scroll down using AutoInput -->
      <Action sr="act13" ve="7">
        <code>660</code>
        <Bundle sr="arg0">
          <Strings sr="net.dinglisch.android.tasker.RELEVANT_VARIABLES">
            <Str sr="0" ve="3">%scroll_px</Str>
          </Strings>
        </Bundle>
        <Str sr="arg1" ve="3">AutoInput Gestures</Str>
        <Int sr="arg2" val="1"/>
        <Int sr="arg3" val="0"/>
        <Str sr="arg4" ve="3">Gesture Type: Swipe
Start X: 50%
Start Y: 80%
End X: 50%
End Y: 20%
Duration: 300</Str>
        <Str sr="arg5" ve="3">action=gesture&amp;gestureType=swipe&amp;startX=50%&amp;startY=80%&amp;endX=50%&amp;endY=20%&amp;duration=300</Str>
      </Action>
      
      <!-- Wait interval -->
      <Action sr="act14" ve="7">
        <code>30</code>
        <Int sr="arg0" val="0"/>
        <Int sr="arg1" val="%interval_ms"/>
      </Action>
      
    </Action>
    
    <!-- End Loop -->
    <Action sr="act15" ve="7">
      <code>40</code>
    </Action>
    
    <!-- Complete capture -->
    <Action sr="act16" ve="7">
      <code>339</code>
      <Str sr="arg0" ve="3">POST</Str>
      <Str sr="arg1" ve="3">%api_url/mobile/complete-capture/%session_code</Str>
      <Str sr="arg2" ve="3">{}</Str>
      <Str sr="arg3" ve="3">application/json</Str>
      <Int sr="arg4" val="30"/>
      <Int sr="arg5" val="1"/>
    </Action>
    
    <!-- Flash completion -->
    <Action sr="act17" ve="7">
      <code>548</code>
      <Str sr="arg0" ve="3">FrameReader: Capture complete! %total_captures frames uploaded.</Str>
      <Int sr="arg1" val="1"/>
    </Action>
    
    <!-- Cleanup temp files -->
    <Action sr="act18" ve="7">
      <code>121</code>
      <Str sr="arg0" ve="3">/sdcard/DCIM/framereader</Str>
      <Int sr="arg1" val="1"/>
      <Int sr="arg2" val="1"/>
    </Action>
    
  </Task>
</TaskerData>
